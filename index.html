<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BALL x PIT è¿›åŒ–å›¾é‰´</title>
  <meta name="description" content="Ball x Pit å®Œæ•´è¿›åŒ–å›¾é‰´ - çŸ©é˜µ/åˆ—è¡¨/å›¾é‰´ä¸‰ç§è§†å›¾">
  
  <style>
    /* ========== CSS å˜é‡ ========== */
    :root {
      --bg-primary: #0a0e14;
      --bg-secondary: #141b22;
      --bg-tertiary: #1a2332;
      --bg-hover: #243044;
      --border-color: #2a3a4a;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --accent-primary: #58a6ff;
      --accent-secondary: #3fb950;
      --accent-warning: #d29922;
      --accent-danger: #f85149;
      --accent-purple: #a371f7;
      --accent-pink: #db61a2;
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
    }

    /* ========== åŸºç¡€æ ·å¼ ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* ========== å¤´éƒ¨ ========== */
    .header {
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      padding: 24px 20px;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* ========== æ§åˆ¶æ  ========== */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
      padding: 16px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .search-box {
      position: relative;
      flex: 1;
      max-width: 320px;
      min-width: 200px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
      transition: var(--transition-fast);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.15);
    }

    .search-box::before {
      content: "ğŸ”";
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      opacity: 0.6;
    }

    .view-tabs {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      padding: 4px;
      gap: 4px;
    }

    .view-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition-fast);
      font-weight: 500;
    }

    .view-tab:hover {
      color: var(--text-primary);
      background: var(--bg-hover);
    }

    .view-tab.active {
      background: var(--accent-primary);
      color: white;
    }

    /* ========== ä¸»å†…å®¹åŒº ========== */
    .main-content {
      padding: 20px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .view-container {
      display: none;
    }

    .view-container.active {
      display: block;
    }

    /* ========== çŸ©é˜µè§†å›¾ ========== */
    .matrix-wrapper {
      overflow-x: auto;
      padding-bottom: 20px;
    }

    .matrix-table {
      border-collapse: collapse;
      margin: 0 auto;
      border: 2px solid #4a5a6a;
    }

    .matrix-table th,
    .matrix-table td {
      width: 60px;
      height: 60px;
      text-align: center;
      vertical-align: middle;
      font-size: 10px;
      position: relative;
      border: 1px solid #2a3a4a;
    }

    .matrix-table th {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 600;
      padding: 4px;
      border: 1px solid #3a4a5a;
    }

    /* ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„è¡¨å¤´åŠ ç²—è¾¹æ¡† */
    .matrix-table tr:first-child th {
      border-bottom: 2px solid #5a6a7a;
    }

    .matrix-table th:first-child {
      border-right: 2px solid #5a6a7a;
    }

    /* æ¯5è¡Œ/åˆ—æ·»åŠ åˆ†éš”çº¿ä¾¿äºé˜…è¯» */
    .matrix-table tr:nth-child(6) td,
    .matrix-table tr:nth-child(6) th,
    .matrix-table tr:nth-child(11) td,
    .matrix-table tr:nth-child(11) th,
    .matrix-table tr:nth-child(16) td,
    .matrix-table tr:nth-child(16) th {
      border-top: 2px solid #3d4d5d;
    }

    .matrix-table td:nth-child(6),
    .matrix-table th:nth-child(6),
    .matrix-table td:nth-child(11),
    .matrix-table th:nth-child(11),
    .matrix-table td:nth-child(16),
    .matrix-table th:nth-child(16) {
      border-left: 2px solid #3d4d5d;
    }

    .matrix-table th img {
      width: 32px;
      height: 32px;
      object-fit: contain;
      display: block;
      margin: 0 auto 2px;
      border-radius: 4px;
    }

    .matrix-table th span {
      display: block;
      font-size: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .matrix-cell {
      background: var(--bg-secondary);
      cursor: pointer;
      transition: var(--transition-fast);
      padding: 4px;
    }

    .matrix-cell:hover {
      background: var(--bg-hover);
      box-shadow: inset 0 0 0 2px var(--accent-primary);
      z-index: 10;
    }

    .matrix-cell.empty {
      background: var(--bg-primary);
      cursor: default;
    }

    .matrix-cell.empty:hover {
      box-shadow: none;
    }

    .matrix-cell img {
      width: 36px;
      height: 36px;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      border-radius: 4px;
    }

    .matrix-cell .cell-name {
      font-size: 8px;
      color: var(--text-secondary);
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .matrix-cell.highlight {
      box-shadow: 0 0 0 2px var(--accent-primary);
    }

    /* ========== åˆ—è¡¨è§†å›¾ ========== */
    .list-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .list-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: var(--transition-normal);
    }

    .list-card:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .list-card-header {
      background: var(--bg-tertiary);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .list-card-header img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border-radius: 6px;
    }

    .list-card-header h3 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .list-card-header .subtitle {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .list-card-body {
      padding: 12px 16px;
    }

    .combo-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .combo-item:last-child {
      border-bottom: none;
    }

    .combo-item:hover {
      background: var(--bg-hover);
      margin: 0 -16px;
      padding: 8px 16px;
    }

    .combo-item img {
      width: 28px;
      height: 28px;
      object-fit: contain;
      margin-right: 10px;
      border-radius: 4px;
    }

    .combo-item .combo-text {
      flex: 1;
      font-size: 13px;
    }

    .combo-item .partner {
      color: var(--text-secondary);
    }

    .combo-item .arrow {
      color: var(--accent-primary);
      margin: 0 8px;
    }

    .combo-item .result {
      color: var(--accent-secondary);
      font-weight: 500;
    }

    /* ========== å›¾é‰´è§†å›¾ ========== */
    .gallery-section {
      margin-bottom: 32px;
    }

    .gallery-section:last-child {
      margin-bottom: 0;
    }

    .gallery-section-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--accent-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .gallery-section-title::before {
      content: "";
      width: 4px;
      height: 18px;
      background: var(--accent-primary);
      border-radius: 2px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }

    .gallery-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-normal);
    }

    .gallery-item:hover {
      border-color: var(--accent-primary);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .gallery-item img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      margin-bottom: 8px;
      border-radius: 8px;
    }

    .gallery-item .item-name {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .gallery-item .item-name-cn {
      font-size: 11px;
      color: var(--text-secondary);
    }

    .gallery-item .item-tier {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      margin-top: 6px;
    }

    .tier-basic {
      background: rgba(88, 166, 255, 0.2);
      color: var(--accent-primary);
    }

    .tier-evolved {
      background: rgba(63, 185, 80, 0.2);
      color: var(--accent-secondary);
    }

    .tier-advanced {
      background: rgba(163, 113, 247, 0.2);
      color: var(--accent-purple);
    }

    .tier-passive {
      background: rgba(210, 153, 34, 0.2);
      color: var(--accent-warning);
    }

    /* ========== å¼¹çª— ========== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      max-width: 480px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalIn 0.25s ease;
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
    }

    .modal-header img {
      width: 72px;
      height: 72px;
      object-fit: contain;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      padding: 8px;
    }

    .modal-header-info h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .modal-header-info .cn-name {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: var(--bg-hover);
      border: none;
      border-radius: 50%;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .modal-close:hover {
      background: var(--accent-danger);
      color: white;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-section {
      margin-bottom: 20px;
    }

    .modal-section:last-child {
      margin-bottom: 0;
    }

    .modal-section h4 {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .combo-formula {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      flex-wrap: wrap;
    }

    .combo-ball {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-sm);
      transition: var(--transition-fast);
    }

    .combo-ball:hover {
      background: var(--bg-hover);
    }

    .combo-ball img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 6px;
    }

    .combo-ball span {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
    }

    .combo-plus {
      font-size: 24px;
      color: var(--text-muted);
      font-weight: 300;
    }

    .combo-equals {
      font-size: 24px;
      color: var(--accent-primary);
    }

    .effect-text {
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.7;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--accent-primary);
    }

    /* ========== é«˜çº§/è¢«åŠ¨è¿›åŒ–åŒº ========== */
    .advanced-section {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border-color);
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title::before {
      content: "";
      width: 4px;
      height: 20px;
      background: var(--accent-purple);
      border-radius: 2px;
    }

    .advanced-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }

    .advanced-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .advanced-card:hover {
      border-color: var(--accent-purple);
      background: var(--bg-tertiary);
    }

    .advanced-card img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 6px;
    }

    .advanced-card-info {
      flex: 1;
    }

    .advanced-card-info h4 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .advanced-card-info p {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* ========== ç©ºçŠ¶æ€ ========== */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* ========== å“åº”å¼ ========== */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 22px;
      }

      .controls {
        padding: 12px;
      }

      .search-box {
        min-width: 100%;
      }

      .main-content {
        padding: 12px;
      }

      .matrix-table th,
      .matrix-table td {
        width: 50px;
        height: 50px;
      }

      .matrix-table th img {
        width: 24px;
        height: 24px;
      }

      .matrix-cell img {
        width: 28px;
        height: 28px;
      }

      .gallery-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      .gallery-item img {
        width: 48px;
        height: 48px;
      }
    }

    /* ========== æ»šåŠ¨æ¡ ========== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* ========== æ‚¬æµ®æç¤ºæ¡† ========== */
    .tooltip {
      position: fixed;
      z-index: 2000;
      background: var(--bg-secondary);
      border: 1px solid var(--accent-primary);
      border-radius: var(--radius-md);
      padding: 12px;
      max-width: 320px;
      min-width: 240px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.15s ease, transform 0.15s ease;
    }

    .tooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .tooltip-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .tooltip-header img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 6px;
      background: var(--bg-tertiary);
      padding: 4px;
    }

    .tooltip-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .tooltip-title-cn {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .tooltip-formula {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 10px;
      padding: 8px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .tooltip-formula img {
      width: 24px;
      height: 24px;
      object-fit: contain;
      border-radius: 4px;
    }

    .tooltip-formula .plus {
      color: var(--text-muted);
    }

    .tooltip-formula .equals {
      color: var(--accent-primary);
      font-weight: bold;
    }

    .tooltip-effect {
      font-size: 12px;
      color: var(--text-primary);
      line-height: 1.5;
      padding: 8px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      border-left: 2px solid var(--accent-primary);
    }

    /* ========== éšè—ç±» ========== */
    .hidden {
      display: none !important;
    }

    /* ========== åŠ è½½æç¤º ========== */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .loading::after {
      content: "";
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>

  <!-- å¤´éƒ¨ -->
  <header class="header">
    <h1>BALL x PIT è¿›åŒ–å›¾é‰´</h1>
    <p>å®Œæ•´è¿›åŒ–ç»„åˆå‚è€ƒ | Complete Evolution Guide</p>
  </header>

  <!-- æ§åˆ¶æ  -->
  <div class="controls">
    <div class="search-box">
      <input 
        type="text" 
        id="searchInput" 
        placeholder="æœç´¢çƒå... / Search balls..."
        autocomplete="off"
      >
    </div>
    
    <div class="view-tabs">
      <button class="view-tab active" data-view="matrix">çŸ©é˜µ</button>
      <button class="view-tab" data-view="list">åˆ—è¡¨</button>
      <button class="view-tab" data-view="gallery">å›¾é‰´</button>
    </div>

  </div>

  <!-- ä¸»å†…å®¹ -->
  <main class="main-content">
    
    <!-- çŸ©é˜µè§†å›¾ -->
    <div id="matrixView" class="view-container active">
      <div class="matrix-wrapper">
        <table class="matrix-table" id="matrixTable">
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- åˆ—è¡¨è§†å›¾ -->
    <div id="listView" class="view-container">
      <div class="list-view" id="listContainer"></div>
    </div>

    <!-- å›¾é‰´è§†å›¾ -->
    <div id="galleryView" class="view-container">
      <div class="gallery-section">
        <h3 class="gallery-section-title">åŸºç¡€çƒ Basic Balls</h3>
        <div class="gallery-grid" id="galleryBasic"></div>
      </div>
      <div class="gallery-section">
        <h3 class="gallery-section-title">è¿›åŒ–çƒ Evolved Balls</h3>
        <div class="gallery-grid" id="galleryEvolved"></div>
      </div>
      <div class="gallery-section">
        <h3 class="gallery-section-title">é«˜çº§è¿›åŒ– Advanced Evolutions</h3>
        <div class="gallery-grid" id="galleryAdvanced"></div>
      </div>
      <div class="gallery-section">
        <h3 class="gallery-section-title">è¢«åŠ¨é“å…· Passive Items</h3>
        <div class="gallery-grid" id="galleryPassive"></div>
      </div>
    </div>

    <!-- é«˜çº§è¿›åŒ–åŒº -->
    <section class="advanced-section" id="advancedSection">
      <h3 class="section-title">é«˜çº§å¼¹ç è¿›åŒ–</h3>
      <div class="advanced-grid" id="advancedGrid"></div>
    </section>

    <!-- è¢«åŠ¨é“å…·è¿›åŒ–åŒº -->
    <section class="advanced-section" id="passiveSection">
      <h3 class="section-title">è¢«åŠ¨é“å…·è¿›åŒ–</h3>
      <div class="advanced-grid" id="passiveGrid"></div>
    </section>

  </main>

  <!-- æ‚¬æµ®æç¤ºæ¡† -->
  <div class="tooltip" id="tooltip">
    <div class="tooltip-header">
      <img id="tooltipImg" src="" alt="">
      <div class="tooltip-title-wrap">
        <div class="tooltip-title" id="tooltipTitle"></div>
        <div class="tooltip-title-cn" id="tooltipTitleCn"></div>
      </div>
    </div>
    <div class="tooltip-effect" id="tooltipEffect"></div>
    <div class="tooltip-formula" id="tooltipFormula"></div>
  </div>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <button class="modal-close" id="modalClose">&times;</button>
      <div class="modal-header">
        <img id="modalImg" src="" alt="">
        <div class="modal-header-info">
          <h2 id="modalTitle"></h2>
          <div class="cn-name" id="modalTitleCn"></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h4>åˆæˆé…æ–¹ / Recipe</h4>
          <div class="combo-formula" id="modalFormula"></div>
        </div>
        <div class="modal-section">
          <h4>æ•ˆæœæè¿° / Effect</h4>
          <div class="effect-text" id="modalEffect"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========== æ•°æ®å®šä¹‰ ==========
    const BASE_BALLS = [
      { id: "BLEED", name: "Bleed", nameCn: "æµè¡€", img: "ball_icon_bleed.png", effectCn: "æ”»å‡»ä¼šä½¿æ•Œäººæµè¡€ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…é€ æˆæŒç»­ä¼¤å®³ã€‚" },
      { id: "BROOD_MOTHER", name: "Brood Mother", nameCn: "è‚²æ¯", img: "ball_icon_brood_mother.png", effectCn: "å‘¨æœŸæ€§åœ°äº§ç”Ÿå°å‹å•ä½ä¸ºä½ ä½œæˆ˜ã€‚" },
      { id: "BURN", name: "Burn", nameCn: "ç‡ƒçƒ§", img: "ball_icon_burn.png", effectCn: "æ”»å‡»ä¼šç‚¹ç‡ƒæ•Œäººï¼Œé€ æˆæŒç»­çš„ç«ç„°ä¼¤å®³ã€‚" },
      { id: "CELL", name: "Cell", nameCn: "ç»†èƒ", img: "ball_icon_cell.png", effectCn: "å…·æœ‰åˆ†è£‚å’Œå¢æ®–èƒ½åŠ›çš„å¼¹ç ã€‚" },
      { id: "CHARM", name: "Charm", nameCn: "é­…æƒ‘", img: "ball_icon_love_charm.png", effectCn: "æ”»å‡»ä¼šè¿·æƒ‘æ•Œäººï¼Œä½¿å…¶æš‚æ—¶åœæ­¢æ”»å‡»æˆ–æ”»å‡»å…¶å‹å†›ã€‚" },
      { id: "DARK", name: "Dark", nameCn: "é»‘æš—", img: "ball_icon_dark.png", effectCn: "è¿ç”¨æš—å½±èƒ½é‡ï¼Œé€šå¸¸é™„å¸¦è¯…å’’æˆ–å‰Šå¼±æ•ˆæœã€‚" },
      { id: "EARTHQUAKE", name: "Earthquake", nameCn: "åœ°éœ‡", img: "ball_icon_earthquake.png", effectCn: "é€ æˆèŒƒå›´æ€§çš„åœ°é¢å†²å‡»å’Œä¼¤å®³ã€‚" },
      { id: "EGG_SAC", name: "Egg Sac", nameCn: "åµå›Š", img: "ball_icon_egg_sac.png", effectCn: "å¯ä»¥å­µåŒ–å‡ºå°å‹ç”Ÿç‰©çš„åµå›Šã€‚" },
      { id: "FREEZE", name: "Freeze", nameCn: "å†°å†»", img: "ball_icon_freeze.png", effectCn: "æ”»å‡»å¯ä»¥å†°å†»æˆ–å‡é€Ÿæ•Œäººã€‚" },
      { id: "GHOST", name: "Ghost", nameCn: "å¹½çµ", img: "ball_icon_ghost.png", effectCn: "å¯ä»¥ç©¿é€æ•Œäººï¼Œé€ æˆéš¾ä»¥é˜²å¾¡çš„ä¼¤å®³ã€‚" },
      { id: "IRON", name: "Iron", nameCn: "é’¢é“", img: "ball_icon_iron.png", effectCn: "åšç¡¬çš„å¼¹ç ï¼Œé€šå¸¸å…·æœ‰æ›´é«˜çš„åŸºç¡€ä¼¤å®³æˆ–ç ´ç”²æ•ˆæœã€‚" },
      { id: "LASER_H", name: "Laser H", nameCn: "æ¿€å…‰(æ¨ª)", img: "ball_icon_laser_horizontal.png", effectCn: "å‘å°„ä¸€é“ç›´çº¿æ¿€å…‰ï¼Œç©¿é€è·¯å¾„ä¸Šçš„æ‰€æœ‰æ•Œäººã€‚" },
      { id: "LASER_V", name: "Laser V", nameCn: "æ¿€å…‰(ç«–)", img: "ball_icon_laser_vertical.png", effectCn: "å‘å°„ä¸€é“ç›´çº¿æ¿€å…‰ï¼Œç©¿é€è·¯å¾„ä¸Šçš„æ‰€æœ‰æ•Œäººã€‚" },
      { id: "LIGHT", name: "Light", nameCn: "å…‰æ˜", img: "ball_icon_light.png", effectCn: "è¿ç”¨å…‰æ˜åŠ›é‡ï¼Œé€šå¸¸å¸¦æœ‰æ²»ç–—æˆ–è‡´ç›²æ•ˆæœã€‚" },
      { id: "LIGHTNING", name: "Lightning", nameCn: "é—ªç”µ", img: "ball_icon_lightning.png", effectCn: "æ”»å‡»å¯ä»¥é‡Šæ”¾è¿é”é—ªç”µï¼Œå¼¹å°„åˆ°å¤šä¸ªæ•Œäººèº«ä¸Šã€‚" },
      { id: "POISON", name: "Poison", nameCn: "æ¯’", img: "ball_icon_poison.png", effectCn: "æ”»å‡»ä¼šä½¿æ•Œäººä¸­æ¯’ï¼Œåœ¨é•¿æ—¶é—´å†…é€ æˆæŒç»­ä¼¤å®³ã€‚" },
      { id: "VAMPIRE", name: "Vampire", nameCn: "å¸è¡€é¬¼", img: "ball_icon_vampire.png", effectCn: "æ”»å‡»å¯ä»¥å°†é€ æˆçš„éƒ¨åˆ†ä¼¤å®³è½¬åŒ–ä¸ºè‡ªèº«ç”Ÿå‘½å€¼ã€‚" },
      { id: "WIND", name: "Wind", nameCn: "é£", img: "ball_icon_wind.png", effectCn: "å¯ä»¥å¹é£æ•Œäººæˆ–å¢å¼ºå…¶ä»–å…ƒç´ æ•ˆæœçš„èŒƒå›´ã€‚" }
    ];

    const EVOLUTIONS = [
      // åŸºç¡€è¿›åŒ–
      { name: "Leech", nameCn: "æ°´è›­", row: "BLEED", col: "BROOD_MOTHER", img: "ball_icon_leech.png", effectCn: "çƒå‡»ä¸­æ•Œäººåï¼Œä¼šé™„ç€åœ¨å…¶èº«ä¸Šï¼Œæ¯ç§’é€ æˆä¼¤å®³ã€‚" },
      { name: "Berserk", nameCn: "ç‹‚æš´", row: "CHARM", col: "BLEED", img: "ball_icon_berserk.png", effectCn: "æš´æ€’ï¼Œä¼¤å®³å¢åŠ 100%ã€‚", alt: true },
      { name: "Berserk", nameCn: "ç‹‚æš´", row: "CHARM", col: "BURN", img: "ball_icon_berserk.png", effectCn: "æš´æ€’ï¼Œä¼¤å®³å¢åŠ 100%ã€‚", alt: true },
      { name: "Sacrifice", nameCn: "çŒ®ç¥­", row: "BLEED", col: "DARK", img: "ball_icon_sacrifice.png", effectCn: "å¯¹æ•Œäººé€ æˆ4å±‚æµè¡€æ•ˆæœï¼Œä¸Šé™ä¸º15å±‚ã€‚æ–½åŠ è¯…å’’ï¼Œ5æ¬¡æ”»å‡»åé€ æˆå¤§é‡ä¼¤å®³ã€‚" },
      { name: "Hemorrhage", nameCn: "å¤§å‡ºè¡€", row: "BLEED", col: "IRON", img: "ball_icon_hemorrhage.png", effectCn: "ç©¿é€æ•Œäººçš„æŠ¤ç”²å¹¶é€ æˆä¼¤å®³ã€‚" },
      { name: "Vampire Lord", nameCn: "å¸è¡€é¬¼é¢†ä¸»", row: "BLEED", col: "VAMPIRE", img: "ball_icon_vampire_lord.png", effectCn: "ç»ˆæå¸è¡€é¬¼ï¼Œå°†å¯¹æ•Œäººé€ æˆçš„ä¼¤å®³è½¬åŒ–ä¸ºç”Ÿå‘½å€¼ã€‚çƒä¼šä¸æ—¶äº§ç”Ÿè™è ï¼Œæ”»å‡»é™„è¿‘çš„æ•Œäººã€‚" },
      { name: "Maggot", nameCn: "è›†è™«", row: "BROOD_MOTHER", col: "CELL", img: "ball_icon_maggot.png", effectCn: "å‘æ•Œäººå‘å°„è›†è™«ï¼Œæ•Œäººæ­»äº¡æ—¶ä¼šç”Ÿå‡ºå°çƒã€‚" },
      { name: "Spider Queen", nameCn: "èœ˜è››å¥³ç‹", row: "BROOD_MOTHER", col: "EGG_SAC", img: "ball_icon_spider_queen.png", effectCn: "æ¯éš”ä¸€æ®µæ—¶é—´äº§ç”Ÿèœ˜è››åµï¼Œå­µåŒ–å‡ºçš„èœ˜è››ä¼šæ”»å‡»é™„è¿‘çš„æ•Œäººã€‚" },
      { name: "Mosquito King", nameCn: "èšŠç‹", row: "BROOD_MOTHER", col: "VAMPIRE", img: "ball_icon_mosquito_king.png", effectCn: "å¬å”¤èšŠå­æ”»å‡»æ•Œäººï¼Œå°†é€ æˆçš„ä¼¤å®³è½¬åŒ–ä¸ºç”Ÿå‘½å€¼ã€‚" },
      { name: "Magma", nameCn: "å²©æµ†", row: "BURN", col: "EARTHQUAKE", img: "ball_icon_magma.png", effectCn: "æ¯éš”ä¸€æ®µæ—¶é—´å–·å‡ºå²©æµ†å—ï¼Œå¯¹æ•Œäººé€ æˆä¼¤å®³å¹¶æ–½åŠ æœ€å¤š3å±‚ç¼çƒ§æ•ˆæœã€‚" },
      { name: "Frozen Flame", nameCn: "å†°å†»ç«ç„°", row: "BURN", col: "FREEZE", img: "ball_icon_frozen_flame.png", effectCn: "å¯¹æ•Œäººé€ æˆå†°ç«åŒé‡ä¼¤å®³ã€‚" },
      { name: "Bomb", nameCn: "ç‚¸å¼¹", row: "BURN", col: "IRON", img: "ball_icon_bomb.png", effectCn: "å‡»ä¸­æ•Œäººæ—¶ä¼šå‘ç”Ÿçˆ†ç‚¸ï¼Œå¯¹çˆ†ç‚¸èŒƒå›´å†…çš„æ‰€æœ‰æ•Œäººé€ æˆä¼¤å®³ã€‚" },
      { name: "Sun", nameCn: "å¤ªé˜³", row: "BURN", col: "LIGHT", img: "ball_icon_sun.png", effectCn: "åŒ–èº«ä¸ºå¤ªé˜³ï¼Œç¼çƒ§å‘¨å›´çš„æ•Œäººã€‚" },
      { name: "Inferno", nameCn: "ç‚¼ç‹±", row: "BURN", col: "WIND", img: "ball_icon_inferno.png", effectCn: "å¯¹åŠå¾„2æ ¼å†…çš„æ•Œäººæ–½åŠ 1å±‚ç¼çƒ§æ•ˆæœï¼ŒæŒç»­6ç§’ã€‚" },
      { name: "Overgrowth", nameCn: "è¿‡åº¦ç”Ÿé•¿", row: "CELL", col: "EARTHQUAKE", img: "ball_icon_overgrowth.png", effectCn: "ä»åœ°é¢å¬å”¤è†æ£˜ï¼Œå¯¹å¤§èŒƒå›´å†…çš„æ•Œäººé€ æˆä¼¤å®³ã€‚" },
      { name: "Radiation Beam", nameCn: "è¾å°„å…‰æŸ", row: "CELL", col: "LASER_H", img: "ball_icon_radiation_beam.png", effectCn: "æ¿€å…‰æŸä¼šé€ æˆè¾å°„ä¼¤å®³ã€‚", alt: true },
      { name: "Virus", nameCn: "ç—…æ¯’", row: "CELL", col: "POISON", img: "ball_icon_vrius.png", effectCn: "æ„ŸæŸ“æ•Œäººï¼Œç—…æ¯’ä¼šåœ¨æ•Œäººä¹‹é—´ä¼ æ’­ï¼Œå¹¶æŒç»­é€ æˆä¼¤å®³ã€‚", alt: true },
      { name: "Incubus", nameCn: "æ¢¦é­‡", row: "CHARM", col: "DARK", img: "ball_icon_incubus.png", effectCn: "è¿·æƒ‘æ•Œäººï¼Œä½¿å…¶åœ¨çŸ­æ—¶é—´å†…ä¸ºä½ ä½œæˆ˜ã€‚" },
      { name: "Lovestruck", nameCn: "çƒ­æ‹", row: "CHARM", col: "LIGHT", img: "ball_icon_lovestruck.png", effectCn: "è®©æ•Œäººé™·å…¥çˆ±æ²³ï¼Œä½¿å…¶åœæ­¢æ”»å‡»å¹¶é™ä½é˜²å¾¡åŠ›ã€‚", alt: true },
      { name: "Succubus", nameCn: "é­…é­”", row: "CHARM", col: "VAMPIRE", img: "ball_icon_succubus.png", effectCn: "å¼•è¯±æ•Œäººï¼Œå¸å–å…¶ç”Ÿå‘½ç²¾åä¸ºä½ æ¢å¤ç”Ÿå‘½å€¼ã€‚" },
      { name: "Phantom", nameCn: "å¹»å½±", row: "DARK", col: "GHOST", img: "ball_icon_phantom.png", effectCn: "è™šæ— å½¢æ€ï¼Œå¯ç©¿è¿‡æ•Œäººã€‚" },
      { name: "Assassin", nameCn: "åˆºå®¢", row: "DARK", col: "IRON", img: "ball_icon_dark_assassin.png", effectCn: "å¯¹ç”Ÿå‘½å€¼ä½äº20%çš„æ•Œäººé€ æˆè‡´å‘½ä¸€å‡»ã€‚", alt: true },
      { name: "Flicker", nameCn: "é—ªçƒ", row: "DARK", col: "LIGHT", img: "ball_icon_flicker.png", effectCn: "æ¯éš”å‡ ç§’å¯¹å±å¹•ä¸Šçš„æ‰€æœ‰æ•Œäººé€ æˆä¼¤å®³ã€‚" },
      { name: "Noxious", nameCn: "å‰§æ¯’", row: "DARK", col: "WIND", img: "ball_icon_noxious.png", effectCn: "åˆ¶é€ ä¸€å›¢æ¯’äº‘ï¼Œéšé£é£˜æ•£ï¼Œå¯¹äº‘ä¸­çš„æ‰€æœ‰æ•Œäººé€ æˆæŒç»­ä¼¤å®³ã€‚", alt: true },
      { name: "Glacier", nameCn: "å†°å·", row: "EARTHQUAKE", col: "FREEZE", img: "ball_icon_glacier.png", effectCn: "æ¯éš”ä¸€æ®µæ—¶é—´é‡Šæ”¾å†°å·å°–åˆºï¼Œå¯¹æ•Œäººé€ æˆä¼¤å®³å¹¶å†°å†»æ•Œäººã€‚" },
      { name: "Swamp", nameCn: "æ²¼æ³½", row: "EARTHQUAKE", col: "POISON", img: "ball_icon_swamp.png", effectCn: "å°†åœ°é¢å˜ä¸ºå‰§æ¯’æ²¼æ³½ï¼Œå‡é€Ÿå¹¶æŒç»­æ¯’å®³å…¶ä¸­çš„æ‰€æœ‰æ•Œäººã€‚" },
      { name: "Sandstorm", nameCn: "æ²™å°˜æš´", row: "EARTHQUAKE", col: "WIND", img: "ball_icon_sandstorm.png", effectCn: "ç©¿è¿‡æ•Œäººæ—¶ï¼Œæ¯ç§’å¯¹æ•Œäººé€ æˆå¤§é‡ä¼¤å®³ã€‚" },
      { name: "Shotgun", nameCn: "éœ°å¼¹æª", row: "IRON", col: "EGG_SAC", img: "ball_icon_shotgun.png", effectCn: "å‘å°„å¤šä¸ªæŠ•å°„ç‰©ã€‚" },
      { name: "Wraith", nameCn: "æ€¨çµ", row: "FREEZE", col: "GHOST", img: "ball_icon_wraith.png", effectCn: "ç©¿è¿‡æ•Œäººæ—¶å†°å†»æ•Œäººã€‚" },
      { name: "Freeze Ray", nameCn: "å†°å†»å°„çº¿", row: "FREEZE", col: "LASER_H", img: "ball_icon_freeze_ray.png", effectCn: "å‘å°„ä¸€é“æ¿€å…‰ï¼Œå†»ç»“è·¯å¾„ä¸Šçš„æ•Œäººã€‚" },
      { name: "Blizzard", nameCn: "æš´é£é›ª", row: "FREEZE", col: "WIND", img: "ball_icon_blizzard.png", effectCn: "åœ¨å°èŒƒå›´å†…å†»ç»“æ‰€æœ‰æ•Œäººï¼Œå¹¶é€ æˆä¼¤å®³ã€‚", alt: true },
      { name: "Soul Sucker", nameCn: "çµé­‚å¸å–è€…", row: "GHOST", col: "VAMPIRE", img: "ball_icon_soul_sucker.png", effectCn: "ç›´æ¥ä»æ•Œäººèº«ä¸Šå¸å–çµé­‚ï¼Œé€ æˆä¼¤å®³å¹¶ä¸ºä½ æ¢å¤ç”Ÿå‘½å€¼ã€‚" },
      { name: "Holy Laser", nameCn: "ç¥åœ£æ¿€å…‰", row: "LASER_V", col: "LASER_H", img: "ball_icon_holy_laser.png", effectCn: "å¯¹åŒä¸€è¡Œå’ŒåŒä¸€åˆ—çš„æ‰€æœ‰æ•Œäººé€ æˆä¼¤å®³ã€‚" },
      { name: "Laser Beam", nameCn: "æ¿€å…‰æŸ", row: "LASER_H", col: "LIGHT", img: "ball_icon_laser_beam.png", effectCn: "å¼ºåŒ–æ¿€å…‰ï¼Œä½¿å…¶æ›´ç²—ã€ä¼¤å®³æ›´é«˜ï¼Œå¹¶èƒ½ç‚¹ç‡ƒæ•Œäººé€ æˆæŒç»­ä¼¤å®³ã€‚" },
      { name: "Flash", nameCn: "é—ªå…‰", row: "LIGHT", col: "LIGHTNING", img: "ball_icon_flash.png", effectCn: "ä»¥é—ªç”µèˆ¬çš„é€Ÿåº¦ç§»åŠ¨å’Œæ”»å‡»ã€‚" },
      { name: "Lightning Rod", nameCn: "é¿é›·é’ˆ", row: "LIGHTNING", col: "IRON", img: "ball_pit_lightning_rod.png", effectCn: "åœ¨å‡»ä¸­ç‚¹å½¢æˆä¸€ä¸ªé¿é›·é’ˆï¼ŒæŒç»­å¸å¼•é—ªç”µæ”»å‡»å‘¨å›´çš„æ•Œäººã€‚" },
      { name: "Storm", nameCn: "é£æš´", row: "LIGHTNING", col: "WIND", img: "ball_icon_storm.png", effectCn: "é‡Šæ”¾é—ªç”µæ”»å‡»é™„è¿‘çš„æ•Œäººã€‚" },
      { name: "Mosquito Swarm", nameCn: "èšŠç¾¤", row: "VAMPIRE", col: "EGG_SAC", img: "ball_icon_mosquito_swarm_erfffn.png", effectCn: "å‡»ä¸­æ—¶çˆ†è£‚æˆå¤šåªèšŠå­ã€‚" },
      { name: "Voluptuous Egg Sac", nameCn: "ä¸°æ»¡åµå›Š", row: "EGG_SAC", col: "CELL", img: "ball_icon_voluptuous_egg_sac.png", effectCn: "çˆ†è£‚æˆå¤šä¸ªåµå›Šã€‚" }
    ];

    const ADVANCED_EVOLUTIONS = [
      { name: "Nuclear Bomb", nameCn: "æ ¸å¼¹", components: ["Bomb", "Poison"], img: "ball_icon_nuclear_bomb.png", effectCn: "åˆ¶é€ ä¸€åœºå·¨å¤§çš„æ ¸çˆ†ï¼Œå¯¹å…¨å±æ•Œäººé€ æˆé«˜é¢åˆå§‹ä¼¤å®³ï¼Œå¹¶åœ¨åç»­ç•™ä¸‹å¼ºçƒˆçš„è¾å°„åŒºåŸŸæŒç»­é€ æˆä¼¤å®³ã€‚" },
      { name: "Black Hole", nameCn: "é»‘æ´", components: ["Sun", "Dark"], img: "ball_icon_black_hole.png", effectCn: "åœ¨å±å¹•ä¸Šåˆ›å»ºä¸€ä¸ªå¼ºå¤§çš„å¼•åŠ›å¥‡ç‚¹ï¼Œå°†å‘¨å›´çš„æ•Œäººå’ŒæŠ•å°„ç‰©å…¨éƒ¨å¸å…¥å¹¶æ¹®ç­ã€‚" },
      { name: "Satan", nameCn: "æ’’æ—¦", components: ["Incubus", "Succubus"], img: "ball_icon_satan.png", effectCn: "å¬å”¤æ¶é­”ä¹‹ç‹æ’’æ—¦ï¼ŒåŒæ—¶æ‹¥æœ‰æ¢¦é­‡çš„æ§åˆ¶å’Œé­…é­”çš„å¸å–èƒ½åŠ›ï¼Œæ˜¯æˆ˜åœºä¸Šçš„ç»ˆæä¸»å®°ã€‚" },
      { name: "Nosferatu", nameCn: "è¯ºæ–¯è´¹æ‹‰å›¾", components: ["Vampire Lord", "Mosquito King", "Spider Queen"], img: "ball_icon_nosferatu.png", effectCn: "å¸è¡€é¬¼ã€èšŠå­å’Œèœ˜è››çš„ç»ˆæèåˆä½“ï¼Œæ‹¥æœ‰æ— ä¸ä¼¦æ¯”çš„ç”Ÿå‘½æ±²å–èƒ½åŠ›å’Œä»†ä»å¤§å†›ï¼Œæ˜¯çœŸæ­£çš„ä¸æ­»å›ç‹ã€‚" }
    ];

    // åŸºç¡€è£…å¤‡(ç”¨äºè¢«åŠ¨é“å…·è¿›åŒ–é…æ–¹æ˜¾ç¤º)
    const BASE_ITEMS = [
      { name: "Everflowing Goblet", nameCn: "æ°¸æµåœ£æ¯", img: "everflowingGoblet.png" },
      { name: "Vampiric Sword", nameCn: "å¸è¡€å‰‘", img: "vampiricSword.png" },
      { name: "Baby Rattle", nameCn: "å©´å„¿æ‘‡é“ƒ", img: "babyRattle.png" },
      { name: "War Horn", nameCn: "æˆ˜äº‰å·è§’", img: "warHorn.png" },
      { name: "Ethereal Cloak", nameCn: "è™šæ— æ–—ç¯·", img: "etherealCloak.png" },
      { name: "Ghostly Corset", nameCn: "å¹½çµèƒ¸è¡£", img: "ghostlyCorset.png" },
      { name: "Breastplate", nameCn: "èƒ¸ç”²", img: "breastplate.png" },
      { name: "Corrupted Onion", nameCn: "è…çƒ‚æ´‹è‘±", img: "wretchedOnion.png" },
      { name: "Reacher's Spear", nameCn: "å»¶ä¼¸è€…ä¹‹çŸ›", img: "reachersSpear.png" },
      { name: "Deadeye's Amulet", nameCn: "ç¥å°„æ‰‹æŠ¤ç¬¦", img: "deadeyesAmulet.png" },
      { name: "Crown of Thorns", nameCn: "è†æ£˜ç‹å† ", img: "crownOfThorns.png" },
      { name: "Spiked Collar", nameCn: "å°–åˆºé¡¹åœˆ", img: "spikedCollar.png" },
      { name: "Fleet Feet", nameCn: "ç–¾è¡Œä¹‹é´", img: "fleetFeet.png" },
      { name: "Radiant Feather", nameCn: "å…‰è¾‰ç¾½æ¯›", img: "radiantFeather.png" },
      { name: "Diamond-Hilted Dagger", nameCn: "é’»çŸ³æŸ„åŒ•é¦–", img: "diamondHiltedDagger.png" },
      { name: "Emerald-Hilted Dagger", nameCn: "ç¿¡ç¿ æŸ„åŒ•é¦–", img: "emeraldHiltedDagger.png" },
      { name: "Ruby-Hilted Dagger", nameCn: "çº¢å®çŸ³æŸ„åŒ•é¦–", img: "rubyHiltedDagger.png" },
      { name: "Sapphire-Hilted Dagger", nameCn: "è“å®çŸ³æŸ„åŒ•é¦–", img: "sapphireHiltedDagger.png" }
    ];

    const PASSIVE_EVOLUTIONS = [
      { name: "Soul Reaver", nameCn: "çµé­‚æ å¤ºè€…", components: ["Everflowing Goblet", "Vampiric Sword"], img: "soulReaver.png", effectCn: "æå¤§åœ°å¢å¼ºä½ çš„ç”Ÿå‘½å·å–æ•ˆæœï¼Œå¹¶å°†æº¢å‡ºçš„æ²»ç–—é‡è½¬åŒ–ä¸ºä¸€ä¸ªå¯ä»¥å¸æ”¶ä¼¤å®³çš„æŠ¤ç›¾ã€‚" },
      { name: "Cornucopia", nameCn: "ä¸°é¥¶ä¹‹è§’", components: ["Baby Rattle", "War Horn"], img: "cornucopia.png", effectCn: "å‘¨æœŸæ€§åœ°äº§ç”Ÿå„ç§èµ„æºï¼ŒåŒ…æ‹¬é‡‘å¸ã€å®çŸ³å’Œç”Ÿå‘½æ¢å¤ï¼Œæ˜¯æŒç»­ä½œæˆ˜çš„å¼ºå¤§ä¿éšœã€‚" },
      { name: "Phantom Regalia", nameCn: "å¹»å½±ç‹æƒ", components: ["Ethereal Cloak", "Ghostly Corset"], img: "phantomRegalia.png", effectCn: "æä¾›æé«˜çš„é—ªé¿å‡ ç‡ï¼Œå¹¶è®©ä½ åœ¨é—ªé¿æˆåŠŸåçŸ­æš‚è¿›å…¥æ— æ•ŒçŠ¶æ€ã€‚" },
      { name: "Odiferous Shell", nameCn: "æ¶è‡­ä¹‹å£³", components: ["Breastplate", "Corrupted Onion"], img: "odiferousShell.png", effectCn: "å½“ä½ å—åˆ°ä¼¤å®³æ—¶ï¼Œä¼šé‡Šæ”¾å‡ºä¸€è‚¡æ¶è‡­ï¼Œå¯¹å‘¨å›´çš„æ•Œäººé€ æˆä¼¤å®³å¹¶é™ä½å…¶æ”»å‡»åŠ›ã€‚" },
      { name: "Gracious Impaler", nameCn: "ä¼˜é›…ç©¿åˆºè€…", components: ["Reacher's Spear", "Deadeye's Amulet"], img: "graciousImpaler.png", effectCn: "ä½ çš„æ‰€æœ‰æŠ•å°„ç‰©éƒ½å°†è·å¾—ç©¿é€æ•ˆæœï¼Œå¹¶å¯¹è¢«ç©¿é€çš„æ¯ä¸ªæ•Œäººé€ æˆé€’å¢çš„ä¼¤å®³ã€‚" },
      { name: "Tormentor's Mask", nameCn: "æŠ˜ç£¨è€…é¢å…·", components: ["Crown of Thorns", "Spiked Collar"], img: "tormentorsMask.png", effectCn: "å°†ä½ å—åˆ°çš„éƒ¨åˆ†ä¼¤å®³åå¼¹ç»™æ”»å‡»è€…ï¼Œå¹¶ä¸”ä½ çš„æ”»å‡»ä¼šå¯¹ç”Ÿå‘½å€¼ä½äº50%çš„æ•Œäººé€ æˆé¢å¤–ä¼¤å®³ã€‚" },
      { name: "Wings of the Anointed", nameCn: "å—è†è€…ä¹‹ç¿¼", components: ["Fleet Feet", "Radiant Feather"], img: "wingsOfTheAnnointed.png", effectCn: "æå¤§åœ°æå‡ä½ çš„ç§»åŠ¨é€Ÿåº¦ï¼Œå¹¶è®©ä½ èƒ½å¤Ÿå…ç–«åœ°é¢ä¸Šçš„é™·é˜±å’Œå‡é€Ÿæ•ˆæœã€‚" },
      { name: "Deadeye's Cross", nameCn: "ç¥å°„æ‰‹åå­—", components: ["Diamond-Hilted Dagger", "Emerald-Hilted Dagger", "Ruby-Hilted Dagger", "Sapphire-Hilted Dagger"], img: "deadeyesCross.png", effectCn: "èåˆå››æŠŠå…ƒç´ åŒ•é¦–çš„åŠ›é‡ï¼Œå¤§å¹…æå‡æš´å‡»ç‡ã€æš´å‡»ä¼¤å®³å’ŒæŠ•å°„ç‰©é€Ÿåº¦ï¼Œæ¯ä¸€å‡»éƒ½ç²¾å‡†è€Œè‡´å‘½ã€‚" }
    ];

    // ========== å…¨å±€å˜é‡ ==========
    let currentView = 'matrix';
    const IMG_BASE = 'img/';
    let searchTimeout = null;

    // ========== æ•°æ®ç´¢å¼• (O(1) æŸ¥æ‰¾) ==========
    const ballById = new Map();
    const ballByName = new Map();
    const evoByName = new Map();
    const itemByName = new Map();
    const evoMatrix = new Map();

    function buildIndexes() {
      BASE_BALLS.forEach(b => {
        ballById.set(b.id, b);
        ballByName.set(b.name, b);
      });
      EVOLUTIONS.forEach(e => evoByName.set(e.name, e));
      ADVANCED_EVOLUTIONS.forEach(e => evoByName.set(e.name, e));
      PASSIVE_EVOLUTIONS.forEach(e => evoByName.set(e.name, e));
      BASE_ITEMS.forEach(i => itemByName.set(i.name, i));
      // çŸ©é˜µç´¢å¼•: "ROW_COL" -> evolution
      EVOLUTIONS.forEach(e => {
        evoMatrix.set(`${e.row}_${e.col}`, e);
        evoMatrix.set(`${e.col}_${e.row}`, e);
      });
    }

    // ========== DOM ç¼“å­˜ ==========
    const DOM = {};
    function cacheDOM() {
      DOM.tooltip = document.getElementById('tooltip');
      DOM.tooltipImg = document.getElementById('tooltipImg');
      DOM.tooltipTitle = document.getElementById('tooltipTitle');
      DOM.tooltipTitleCn = document.getElementById('tooltipTitleCn');
      DOM.tooltipEffect = document.getElementById('tooltipEffect');
      DOM.tooltipFormula = document.getElementById('tooltipFormula');
      DOM.modalOverlay = document.getElementById('modalOverlay');
      DOM.modalImg = document.getElementById('modalImg');
      DOM.modalTitle = document.getElementById('modalTitle');
      DOM.modalTitleCn = document.getElementById('modalTitleCn');
      DOM.modalEffect = document.getElementById('modalEffect');
      DOM.modalFormula = document.getElementById('modalFormula');
      DOM.searchInput = document.getElementById('searchInput');
      DOM.matrixTable = document.getElementById('matrixTable');
      DOM.listContainer = document.getElementById('listContainer');
      DOM.galleryBasic = document.getElementById('galleryBasic');
      DOM.galleryEvolved = document.getElementById('galleryEvolved');
      DOM.galleryAdvanced = document.getElementById('galleryAdvanced');
      DOM.galleryPassive = document.getElementById('galleryPassive');
      DOM.advancedGrid = document.getElementById('advancedGrid');
      DOM.passiveGrid = document.getElementById('passiveGrid');
      DOM.advancedSection = document.getElementById('advancedSection');
      DOM.passiveSection = document.getElementById('passiveSection');
    }

    // ========== å·¥å…·å‡½æ•° ==========
    function getImg(filename) {
      return IMG_BASE + (filename || 'ball_icon_bleed.png');
    }

    // è½¬ä¹‰æ’‡å·, ä»…ç”¨äºå†…è” JavaScript å­—ç¬¦ä¸²
    // æ­£ç¡®ç”¨æ³•: onclick="func('${safeName(name)}')"
    // é”™è¯¯ç”¨æ³•: data-evo="${safeName(name)}"  (data-* å±æ€§ä¸éœ€è¦è½¬ä¹‰!)
    // åŸå› : data-* å±æ€§å€¼ä¼šè¢«æµè§ˆå™¨åŸæ ·ä¿å­˜, è½¬ä¹‰å­—ç¬¦ä¼šå˜æˆå­—é¢å­—ç¬¦
    function safeName(str) {
      return str ? str.replace(/'/g, "\\'") : '';
    }

    // ç”Ÿæˆå›¾ç‰‡ HTML
    function imgHtml(src, alt, className) {
      const cls = className ? ` class="${className}"` : '';
      return `<img${cls} src="${getImg(src)}" alt="${alt || ''}" onerror="this.src='${getImg('placeholder.png')}'">`;
    }

    function getName(item) {
      return item.nameCn || item.name;
    }

    function getEffect(item) {
      return item.effectCn || item.effect || '';
    }

    function getBaseBall(id) {
      return ballById.get(id);
    }

    function getBaseItem(name) {
      return itemByName.get(name);
    }

    function getEvolution(name) {
      return evoByName.get(name);
    }

    function findEvolution(rowId, colId) {
      return evoMatrix.get(`${rowId}_${colId}`);
    }

    // ç»Ÿä¸€æŸ¥æ‰¾ç»„ä»¶ (åŸºç¡€çƒ/è¿›åŒ–çƒ/è£…å¤‡)
    function findComponent(name) {
      return ballByName.get(name) || evoByName.get(name) || itemByName.get(name);
    }

    // è·å–ç»„ä»¶çš„ä¸­æ–‡åç§°
    function getComponentNameCn(name) {
      const comp = findComponent(name);
      return comp ? (comp.nameCn || name) : name;
    }

    // ========== çŸ©é˜µè§†å›¾ ==========
    function renderMatrix() {
      let html = '<tr><th></th>';
      
      // è¡¨å¤´
      BASE_BALLS.forEach(ball => {
        html += `<th data-id="${ball.id}" data-type="base">
          ${imgHtml(ball.img, ball.name)}
          <span>${getName(ball)}</span>
        </th>`;
      });
      html += '</tr>';

      // è¡¨ä½“
      BASE_BALLS.forEach(rowBall => {
        html += `<tr><th data-id="${rowBall.id}" data-type="base">
          ${imgHtml(rowBall.img, rowBall.name)}
          <span>${getName(rowBall)}</span>
        </th>`;

        BASE_BALLS.forEach(colBall => {
          const evo = findEvolution(rowBall.id, colBall.id);
          if (evo) {
            html += `<td class="matrix-cell" data-evo="${evo.name}" data-type="evo">
              ${imgHtml(evo.img, evo.name)}
              <div class="cell-name">${getName(evo)}${evo.alt ? '*' : ''}</div>
            </td>`;
          }
          else {
            html += `<td class="matrix-cell empty"></td>`;
          }
        });

        html += '</tr>';
      });

      DOM.matrixTable.innerHTML = html;
    }

    // ========== åˆ—è¡¨è§†å›¾ ==========
    function renderList() {
      let html = '';

      BASE_BALLS.forEach(baseBall => {
        const combos = EVOLUTIONS.filter(e => e.row === baseBall.id || e.col === baseBall.id);
        if (combos.length === 0) return;

        html += `<div class="list-card">
          <div class="list-card-header">
            ${imgHtml(baseBall.img, baseBall.name)}
            <div>
              <h3>${getName(baseBall)}</h3>
              <div class="subtitle">${combos.length} ç§ç»„åˆ</div>
            </div>
          </div>
          <div class="list-card-body">`;

        combos.forEach(evo => {
          const partnerId = evo.row === baseBall.id ? evo.col : evo.row;
          const partner = getBaseBall(partnerId);
          if (!partner) return;

          html += `<div class="combo-item" data-evo="${evo.name}">
            ${imgHtml(evo.img, evo.name)}
            <div class="combo-text">
              <span class="partner">+ ${getName(partner)}</span>
              <span class="arrow">â†’</span>
              <span class="result">${getName(evo)}${evo.alt ? '*' : ''}</span>
            </div>
          </div>`;
        });

        html += '</div></div>';
      });

      DOM.listContainer.innerHTML = html;
    }

    // ========== å›¾é‰´è§†å›¾ ==========
    // ç”Ÿæˆå›¾é‰´é¡¹ HTML
    // æ³¨æ„: data-* å±æ€§ä½¿ç”¨åŸå§‹å€¼, ä¸éœ€è¦ safeName() è½¬ä¹‰
    function galleryItemHtml(item, type, idOrName) {
      const dataAttr = type === 'base' ? `data-id="${idOrName}"` : `data-evo="${idOrName}"`;
      return `<div class="gallery-item" ${dataAttr} data-type="${type}">
        ${imgHtml(item.img, item.name)}
        <div class="item-name">${item.name}</div>
        <div class="item-name-cn">${item.nameCn || ''}</div>
      </div>`;
    }

    function renderGallery() {
      // åŸºç¡€çƒ
      DOM.galleryBasic.innerHTML = BASE_BALLS.map(b => galleryItemHtml(b, 'base', b.id)).join('');

      // è¿›åŒ–çƒ (å»é‡)
      const uniqueEvos = [...new Map(EVOLUTIONS.map(e => [e.name, e])).values()];
      DOM.galleryEvolved.innerHTML = uniqueEvos.map(e => galleryItemHtml(e, 'evo', e.name)).join('');

      // é«˜çº§è¿›åŒ–
      DOM.galleryAdvanced.innerHTML = ADVANCED_EVOLUTIONS.map(e => galleryItemHtml(e, 'evo', e.name)).join('');

      // è¢«åŠ¨é“å…·
      DOM.galleryPassive.innerHTML = PASSIVE_EVOLUTIONS.map(e => galleryItemHtml(e, 'evo', e.name)).join('');
    }

    // ========== é«˜çº§/è¢«åŠ¨è¿›åŒ–åŒº ==========
    // ç”Ÿæˆé«˜çº§å¡ç‰‡ HTML
    // æ³¨æ„: data-evo ä½¿ç”¨åŸå§‹å€¼, ä¸éœ€è¦ safeName() è½¬ä¹‰
    function advancedCardHtml(evo) {
      const componentsCn = evo.components.map(c => getComponentNameCn(c)).join(' + ');
      return `<div class="advanced-card" data-evo="${evo.name}" data-type="evo">
        ${imgHtml(evo.img, evo.name)}
        <div class="advanced-card-info">
          <h4>${getName(evo)}</h4>
          <p>${componentsCn}</p>
        </div>
      </div>`;
    }

    function renderAdvancedSections() {
      DOM.advancedGrid.innerHTML = ADVANCED_EVOLUTIONS.map(advancedCardHtml).join('');
      DOM.passiveGrid.innerHTML = PASSIVE_EVOLUTIONS.map(advancedCardHtml).join('');
    }

    // ========== æ‚¬æµ®æç¤ºæ¡† ==========
    const TOOLTIP_WIDTH = 320;
    const TOOLTIP_HEIGHT = 200;

    // æ„å»ºé…æ–¹ HTML
    function buildFormulaHtml(item) {
      let html = '';
      
      if (item.row && item.col) {
        // åŸºç¡€è¿›åŒ–: ä¸¤ä¸ªåŸºç¡€çƒç»„åˆ
        const ball1 = getBaseBall(item.row);
        const ball2 = getBaseBall(item.col);
        if (ball1) html += `<img src="${getImg(ball1.img)}"><span>${getName(ball1)}</span>`;
        html += '<span class="plus">+</span>';
        if (ball2) html += `<img src="${getImg(ball2.img)}"><span>${getName(ball2)}</span>`;
        html += '<span class="equals">=</span>';
        html += `<img src="${getImg(item.img)}"><span>${getName(item)}</span>`;
      }
      else if (item.components) {
        // é«˜çº§/è¢«åŠ¨è¿›åŒ–: å¤šä¸ªç»„ä»¶
        item.components.forEach((comp, i) => {
          const c = findComponent(comp);
          if (c) {
            html += `<img src="${getImg(c.img)}"><span>${c.nameCn || comp}</span>`;
          }
          else {
            html += `<span>${comp}</span>`;
          }
          if (i < item.components.length - 1) html += '<span class="plus">+</span>';
        });
        html += '<span class="equals">=</span>';
        html += `<img src="${getImg(item.img)}"><span>${getName(item)}</span>`;
      }
      
      return html;
    }

    // è®¡ç®— tooltip ä½ç½®
    function calcTooltipPosition(rect) {
      let left = rect.right + 10;
      let top = rect.top;

      if (left + TOOLTIP_WIDTH > window.innerWidth) {
        left = rect.left - TOOLTIP_WIDTH - 10;
      }
      if (left < 0) {
        left = rect.left;
        top = rect.bottom + 10;
      }
      if (top + TOOLTIP_HEIGHT > window.innerHeight) {
        top = window.innerHeight - TOOLTIP_HEIGHT - 10;
      }
      if (top < 10) top = 10;

      return { left, top };
    }

    function showTooltip(event, name, type) {
      const item = type === 'base' ? getBaseBall(name) : getEvolution(name);
      if (!item) return;

      // å¡«å……å†…å®¹ (ä½¿ç”¨ç¼“å­˜çš„ DOM)
      DOM.tooltipImg.src = getImg(item.img);
      DOM.tooltipTitle.textContent = item.name;
      DOM.tooltipTitleCn.textContent = item.nameCn || '';
      DOM.tooltipEffect.textContent = getEffect(item);

      // é…æ–¹
      const formulaHtml = buildFormulaHtml(item);
      DOM.tooltipFormula.innerHTML = formulaHtml;
      DOM.tooltipFormula.style.display = formulaHtml ? 'flex' : 'none';

      // ä½ç½®
      const target = event.target.closest('th, .matrix-cell, .gallery-item, .advanced-card');
      if (!target) return;
      
      const pos = calcTooltipPosition(target.getBoundingClientRect());
      DOM.tooltip.style.left = pos.left + 'px';
      DOM.tooltip.style.top = pos.top + 'px';
      DOM.tooltip.classList.add('visible');
    }

    function hideTooltip() {
      DOM.tooltip.classList.remove('visible');
    }

    // ========== å¼¹çª— ==========
    // ç”Ÿæˆå¼¹çª—ä¸­çš„ç»„ä»¶çƒ HTML
    function comboBallHtml(item, clickable) {
      const onclick = clickable ? ` data-modal="${safeName(item.name)}"` : '';
      return `<div class="combo-ball"${onclick}>
        ${imgHtml(item.img, item.name)}
        <span>${getName(item)}</span>
      </div>`;
    }

    function openModal(evoName) {
      const evo = getEvolution(evoName);
      if (!evo) return;

      DOM.modalImg.src = getImg(evo.img);
      DOM.modalTitle.textContent = evo.name;
      DOM.modalTitleCn.textContent = evo.nameCn || '';
      DOM.modalEffect.textContent = getEffect(evo);

      let formulaHtml = '';
      
      if (evo.row && evo.col) {
        const ball1 = getBaseBall(evo.row);
        const ball2 = getBaseBall(evo.col);
        if (ball1) formulaHtml += comboBallHtml(ball1, false);
        formulaHtml += '<span class="combo-plus">+</span>';
        if (ball2) formulaHtml += comboBallHtml(ball2, false);
      }
      else if (evo.components) {
        evo.components.forEach((comp, i) => {
          const c = findComponent(comp);
          if (c) {
            const isEvo = evoByName.has(comp);
            formulaHtml += comboBallHtml(c, isEvo);
          }
          else {
            formulaHtml += `<div class="combo-ball"><span>${comp}</span></div>`;
          }
          if (i < evo.components.length - 1) {
            formulaHtml += '<span class="combo-plus">+</span>';
          }
        });
      }

      formulaHtml += '<span class="combo-equals">=</span>';
      formulaHtml += comboBallHtml(evo, false);

      DOM.modalFormula.innerHTML = formulaHtml;
      DOM.modalOverlay.classList.add('active');
    }

    function closeModal() {
      DOM.modalOverlay.classList.remove('active');
    }

    // ========== æœç´¢ (å¸¦é˜²æŠ–) ==========
    function doSearch(query) {
      query = query.toLowerCase().trim();
      
      // çŸ©é˜µè§†å›¾
      document.querySelectorAll('.matrix-cell:not(.empty)').forEach(cell => {
        const evoName = cell.dataset.evo?.toLowerCase() || '';
        const evo = getEvolution(cell.dataset.evo);
        const nameCn = evo?.nameCn?.toLowerCase() || '';
        cell.style.opacity = (query && !evoName.includes(query) && !nameCn.includes(query)) ? '0.2' : '1';
      });

      // åˆ—è¡¨è§†å›¾
      document.querySelectorAll('.list-card').forEach(card => {
        const match = !query || card.textContent.toLowerCase().includes(query);
        card.style.display = match ? 'block' : 'none';
      });

      // å›¾é‰´è§†å›¾
      document.querySelectorAll('.gallery-item').forEach(item => {
        const match = !query || item.textContent.toLowerCase().includes(query);
        item.style.display = match ? 'block' : 'none';
      });

      // é«˜çº§/è¢«åŠ¨åŒºåŸŸ
      document.querySelectorAll('.advanced-card').forEach(card => {
        const match = !query || card.textContent.toLowerCase().includes(query);
        card.style.display = match ? 'flex' : 'none';
      });
    }

    // é˜²æŠ–æœç´¢
    function handleSearch(query) {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => doSearch(query), 150);
    }

    // ========== è§†å›¾åˆ‡æ¢ ==========
    function switchView(view) {
      currentView = view;
      
      document.querySelectorAll('.view-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.view === view);
      });

      document.querySelectorAll('.view-container').forEach(container => {
        container.classList.toggle('active', container.id === view + 'View');
      });

      // å›¾é‰´è§†å›¾è‡ªå¸¦é«˜çº§åŒºåŸŸ, å…¶ä»–è§†å›¾æ˜¾ç¤ºåº•éƒ¨åŒºåŸŸ
      const showAdvanced = view !== 'gallery';
      DOM.advancedSection.style.display = showAdvanced ? 'block' : 'none';
      DOM.passiveSection.style.display = showAdvanced ? 'block' : 'none';
    }

    // ========== æ¸²æŸ“å…¨éƒ¨ ==========
    function renderAll() {
      renderMatrix();
      renderList();
      renderGallery();
      renderAdvancedSections();
    }

    // ========== äº‹ä»¶å§”æ‰˜ ==========
    function setupEventDelegation() {
      // çŸ©é˜µè¡¨æ ¼: æ‚¬åœæç¤º
      DOM.matrixTable.addEventListener('mouseenter', (e) => {
        const cell = e.target.closest('[data-type]');
        if (!cell) return;
        const type = cell.dataset.type;
        const name = type === 'base' ? cell.dataset.id : cell.dataset.evo;
        if (name) showTooltip(e, name, type);
      }, true);
      
      DOM.matrixTable.addEventListener('mouseleave', (e) => {
        if (e.target.closest('[data-type]')) hideTooltip();
      }, true);

      // å›¾é‰´è§†å›¾: æ‚¬åœæç¤º
      const galleryContainer = document.getElementById('galleryView');
      galleryContainer.addEventListener('mouseenter', (e) => {
        const item = e.target.closest('.gallery-item');
        if (!item) return;
        const type = item.dataset.type;
        const name = type === 'base' ? item.dataset.id : item.dataset.evo;
        if (name) showTooltip(e, name, type);
      }, true);
      
      galleryContainer.addEventListener('mouseleave', (e) => {
        if (e.target.closest('.gallery-item')) hideTooltip();
      }, true);

      // é«˜çº§/è¢«åŠ¨åŒºåŸŸ: æ‚¬åœæç¤º
      [DOM.advancedGrid, DOM.passiveGrid].forEach(grid => {
        grid.addEventListener('mouseenter', (e) => {
          const card = e.target.closest('.advanced-card');
          if (card && card.dataset.evo) showTooltip(e, card.dataset.evo, 'evo');
        }, true);
        
        grid.addEventListener('mouseleave', (e) => {
          if (e.target.closest('.advanced-card')) hideTooltip();
        }, true);
      });

      // åˆ—è¡¨è§†å›¾: ç‚¹å‡»æ‰“å¼€å¼¹çª—
      DOM.listContainer.addEventListener('click', (e) => {
        const item = e.target.closest('.combo-item');
        if (item && item.dataset.evo) openModal(item.dataset.evo);
      });

      // å¼¹çª—å†…ç»„ä»¶ç‚¹å‡»
      DOM.modalFormula.addEventListener('click', (e) => {
        const ball = e.target.closest('[data-modal]');
        if (ball) openModal(ball.dataset.modal);
      });
    }

    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', () => {
      // æ„å»ºæ•°æ®ç´¢å¼•
      buildIndexes();
      
      // ç¼“å­˜ DOM å…ƒç´ 
      cacheDOM();
      
      // æ¸²æŸ“è§†å›¾
      renderAll();
      
      // è®¾ç½®äº‹ä»¶å§”æ‰˜
      setupEventDelegation();

      // è§†å›¾åˆ‡æ¢
      document.querySelectorAll('.view-tab').forEach(tab => {
        tab.addEventListener('click', () => switchView(tab.dataset.view));
      });

      // æœç´¢ (é˜²æŠ–)
      DOM.searchInput.addEventListener('input', (e) => handleSearch(e.target.value));

      // å¼¹çª—å…³é—­
      document.getElementById('modalClose').addEventListener('click', closeModal);
      DOM.modalOverlay.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal();
      });

      // ESC å…³é—­å¼¹çª—å’Œæç¤ºæ¡†
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
          hideTooltip();
        }
      });
    });
  </script>

</body>
</html>

